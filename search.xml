<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Ubuntu系统备份方式记录</title>
      <link href="/archives/d58ae5e.html"/>
      <url>/archives/d58ae5e.html</url>
      
        <content type="html"><![CDATA[<p>传说中的“有备无患”</p><p><a href="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.0/200404/artical_200404_cover.png" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.0/200404/artical_200404_cover.png" alt="img"></a></p><a id="more"></a><p>先秦·左丘明《左传·襄公十一年》：“《书》曰：“居安思危。思则有备，有备则无患。”</p><p>在使用Ubuntu系统的过程中，由于系统的可定制性太高，以至于在使用系统的过程中容易对系统造成一些损坏或者错误的设置(?)。在遇到一些无法修复的系统问题时，往往会选择重装系统，可是重装系统以后，所有的软件、系统设置、美化设置全部都要重新来一遍</p><p>不想重装系统的话，还有一种办法就是对系统进行备份，经常性地对系统进行备份也可以避免重装系统后重新做系统的所有设置</p><h2 id="分清楚硬盘分区情况"><a href="#分清楚硬盘分区情况" class="headerlink" title="分清楚硬盘分区情况"></a>分清楚硬盘分区情况</h2><p>在对分区进行备份之前，首先我们要搞清楚Ubuntu备份的操作做了什么</p><p>Linux系统的特点是不对文件和目录(文件夹)进行区分，文件是文件，目录也是文件，所以我们可以对整个分区进行压缩打包，打包成一个独立的文件存放在硬盘上的某个地方，在需要还原的时候再见这个压缩包解压覆盖到相对应的分区位置即可</p><p>因为这种备份操作的特性，所以我们需要先搞清楚自己硬盘的分区情况，对每个分区进行独立的备份</p><p>在安装Ubuntu系统的时候，所有用户都会经过分区的操作，此时系统会决定哪些目录会占用独立的分区，我们首先要通过各种方法拿到这种分区划分</p><h4 id="通过任务管理器查看"><a href="#通过任务管理器查看" class="headerlink" title="通过任务管理器查看"></a>通过任务管理器查看</h4><p>这是最直接最快捷的方法，适用于一切用户，即使你完全不会使用终端命令</p><p>在应用中心打开系统监视器，切换到<code>File Systems</code>，即可查看所有挂载的文件分区</p><p><a href="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.1/200404/System_Monitor.png" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.1/200404/System_Monitor.png" alt="file systems"></a></p><p>举个例子，上图是作者机器上的系统监视器给出的信息，从中我们可以看出作者的机器上一共挂载3种分区</p><blockquote><ul><li>系统引导分区 分区类型是vfat，在Windows下是fat32</li><li>Linux分区    分区类型是ext2/ext3/ext4，在Windows下一般不可见(笑</li><li>其他数据分区 分区类型是fuseblk，在Windows下是ntfs</li></ul></blockquote><p>我们需要备份的是几个在Windows下不可见的Linux分区，在这个例子中也就是</p><blockquote><ul><li>/      根分区，挂在位置在sda7</li><li>/boot  启动分区，挂载位置在sda6</li><li>/home 主分区，挂载位置在sdc5</li></ul></blockquote><h4 id="通过系统自带的硬盘工具查看"><a href="#通过系统自带的硬盘工具查看" class="headerlink" title="通过系统自带的硬盘工具查看"></a>通过系统自带的硬盘工具查看</h4><p>当然了，条条大路通罗马，除了使用系统监视器以外，我们也可以使用Ubuntu系统自带的硬盘工具查看分区情况；不过这个工具隐藏的位置比较深入，在应用中心中有一个<code>Utilities</code>文件夹，在这个文件夹中可以找到<code>Disk</code>工具</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.1/200404/disk.png" alt="disk"></p><p>从作者机器上这个工具的截图看，当前选中的分区位于第一块硬盘（sda，一块240G的固态硬盘）的末尾，分区挂载在dev/sda7，以根分区文件系统的形式挂载(Filesystem Root)</p><p>这个工具给出的信息比较多，当然对新手也更不友好，不过毕竟是图形界面，到处看看还是能看出点门道来的</p><h4 id="通过fstab文件查看"><a href="#通过fstab文件查看" class="headerlink" title="通过fstab文件查看"></a>通过fstab文件查看</h4><p>在Ubuntu系统中，如果想要开机自动挂载某个分区，则需要在fstab文件中写出该分区在硬盘上的位置、想要挂载到的位置，挂载形式，开机是否进行自动检查等参数，Linux分区的挂载同样需要这个文件，我们可以通过这个文件看出我们所需要的信息</p><p>在终端中输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gedit /etc/fstab</span><br></pre></td></tr></table></figure><p>fstab文件属于系统文件，需要超级用户权限才能修改，如果需要修改，需要在命令前面添加sudo前缀临时获得权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/fstab</span><br></pre></td></tr></table></figure><p>警示！！！不建议在没有备份的情况下修改fstab文件的内容，Ubuntu系统在开机时如果挂载到了错误的分区，会直接进入Recovery模式，无法正常开机，需要修改成正确的fstab文件才能开机</p><p>备份fstab文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/fstab /etc/fstab.back</span><br></pre></td></tr></table></figure><p>fstab文件内容如下</p><p><a href="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.1/200404/fstab.png" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.1/200404/fstab.png" alt="fstab"></a></p><p>从fstab文件中我们可以得到与系统监视器一样的结论，不过开机后再挂载的移动设备不会包含在fstab文件中</p><h4 id="使用终端命令查看"><a href="#使用终端命令查看" class="headerlink" title="使用终端命令查看"></a>使用终端命令查看</h4><p>最后一种方法，怎么能少得了万能的命令行呢，只给图形界面的操作方法，你瞧谁不起呢！</p><p>在Ubuntu终端中查看分区信息有多少种方法，这里只介绍最常用的一种，使用<code>fdisk</code>命令查看</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk -l</span><br></pre></td></tr></table></figure><p>命令行会输出一大堆信息，其中会有我们所需要的信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Disk /dev/sda: 223.6 GiB, 240057409536 bytes, 468862128 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel type: gpt</span><br><span class="line">Disk identifier: 0F20B151-2873-439C-845D-E38042C81A30</span><br><span class="line"></span><br><span class="line">Device         Start       End   Sectors   Size Type</span><br><span class="line">/dev/sda1       2048   1023999   1021952   499M Windows recovery environment</span><br><span class="line">/dev/sda2    1024000   1228799    204800   100M EFI System</span><br><span class="line">/dev/sda3    1228800   1261567     32768    16M Microsoft reserved</span><br><span class="line">/dev/sda4    1261568 247818695 246557128 117.6G Microsoft basic data</span><br><span class="line">/dev/sda5  247818696 249571327   1752632 855.8M Windows recovery environment</span><br><span class="line">/dev/sda6  249571328 253571071   3999744   1.9G Linux filesystem</span><br><span class="line">/dev/sda7  253571072 468860927 215289856 102.7G Linux filesystem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 3.7 TiB, 4000787030016 bytes, 7814037168 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 4096 bytes / 33553920 bytes</span><br><span class="line">Disklabel type: gpt</span><br><span class="line">Disk identifier: 0CFA0E31-5858-9090-8081-828310111213</span><br><span class="line"></span><br><span class="line">Device     Start        End    Sectors  Size Type</span><br><span class="line">/dev/sdb1   2048 7814031231 7814029184  3.7T Microsoft basic data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/sdc: 931.5 GiB, 1000204886016 bytes, 1953525168 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 4096 bytes</span><br><span class="line">I/O size (minimum/optimal): 4096 bytes / 4096 bytes</span><br><span class="line">Disklabel type: gpt</span><br><span class="line">Disk identifier: 0C5204A1-5858-9090-8081-828310111213</span><br><span class="line"></span><br><span class="line">Device          Start        End   Sectors   Size Type</span><br><span class="line">/dev/sdc1   252268696 1075230519 822961824 392.4G Microsoft basic data</span><br><span class="line">/dev/sdc2  1075230520 1411679744 336449225 160.4G Microsoft basic data</span><br><span class="line">/dev/sdc3  1411679808 1726328840 314649033   150G Microsoft basic data</span><br><span class="line">/dev/sdc4  1726328904 1953519137 227190234 108.3G Microsoft basic data</span><br><span class="line">/dev/sdc5        2048  236267519 236265472 112.7G Linux filesystem</span><br><span class="line">/dev/sdc6   236267520  252268543  16001024   7.6G Linux swap</span><br></pre></td></tr></table></figure><p>我们只需要看<code>type</code>是<code>Linux filesystem</code>的分区即可，通过上面的信息和分区大小的匹配，可以得出与系统监视器相同的结论</p><p>通过条条大路到达罗马后，我们可以得出结论，需要备份的Linux分区有以下三个</p><blockquote><ul><li>/      根分区，挂在位置在sda7，大小是45.0GB</li><li>/boot  启动分区，挂载位置在sda6，大小是125.5MB</li><li>/home 主分区，挂载位置在sdc5，大小是42.4GB</li></ul></blockquote><h2 id="打包命令的使用"><a href="#打包命令的使用" class="headerlink" title="打包命令的使用"></a>打包命令的使用</h2><p>在Ubuntu下，可使用<code>tar</code>命令对文件和目录创建打包档案。利用这一命令，可以为某一个文件创建档案，也可以将一大堆文件和目录全部打包成一个文件，用户也随时可以向档案中增添或删减文件，这对于档案的储存和管理是非常有用的</p><p>可能有细心的读者会发现这其中有一些细微的差别：<code>tar</code>命令只是打包操作，打包操作是不包含压缩这个选项的。没错，打包和压缩是文件管理中分立的两个概念</p><blockquote><ul><li>打包是将一堆文件和目录变成一个总的文件</li><li>压缩是将一个大文件通过压缩算法变成一个小文件</li></ul></blockquote><p>为什么要区分这两个概念呢，这源于Linux下的很多压缩程序并不具备打包的功能，他们只能操作单独的文件，所以如果要进行压缩打包，要先使用<code>tar</code>指令打包，再使用<code>gzip</code>或<code>gzip2</code>指令进行压缩</p><p><code>tar</code>命令的使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar [required para][optional para][files or directory]</span><br></pre></td></tr></table></figure><p>参数含义</p><p>必要参数(required para)</p><p>-A   新增压缩文件到已存在的压缩<br>-B   设置区块大小<br>-c   建立新的压缩文件<br>-d   记录文件的差别<br>-r    加文件到已经压缩的文件<br>-u   添加改变了和现有的文件到已经存在的压缩文件<br>-x   从压缩的文件中提取文件<br>-t   显示压缩文件的内容<br>-z   使用gzip压缩文件，减少占用空间<br>-j   使用bzip2压缩文件，减少占用空间<br>-Z   支持compress解压文件<br>-v   显示操作过程<br>-l   文件系统边界设置<br>-k   保留原有文件不覆盖<br>-m   保留文件不被覆盖<br>-W   确认压缩文件的正确性<br>-p   用原来的文件权限还原文件</p><p>可选参数(optional para)</p><p>-b   设置区块数目<br>-C   切换到指定目录<br>-f   指定压缩文件(带路径)，只能作为最后一个参数<br>—help   显示帮助信息<br>—version   显示版本信息<br>—exclude   排除指定目录，不进行备份</p><h2 id="进行备份前准备"><a href="#进行备份前准备" class="headerlink" title="进行备份前准备"></a>进行备份前准备</h2><p>备份前需要对系统进行必要的瘦身，因为我们是备份整个系统，所以备份一些不必要的内容会增加空间占用</p><p>删除旧版本软件缓存</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get autoclean</span><br></pre></td></tr></table></figure><p>清除所有软件缓存</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get clean</span><br></pre></td></tr></table></figure><p>清除系统中不再使用的孤立软件(慎用，有可能会将一些依赖删除)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get autoremove</span><br></pre></td></tr></table></figure><h2 id="开始备份"><a href="#开始备份" class="headerlink" title="开始备份"></a>开始备份</h2><p>准备工作的最后一步，我们需要寻找一个合适的备份介质，首先这个介质需要有足够大的剩余空间，能够放下整个分区的文件；其次这个位置需要比较安全，而且重装系统的过程中不能被覆盖</p><p>建议放在大容量的机械硬盘分区里面或者外置的储存设备，作者使用的就是由机械硬盘盒和台式机机械硬盘组成的外置储存设备</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.1/200404/disk_table.png" alt="disk table"></p><p>首先 打开终端(笑</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+Shift+T</span><br></pre></td></tr></table></figure><p>切换到root用户，避免权限问题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure><p>如果是第一次使用root用户的话，需要先设置root账户密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure><p>根据提示设置密码并确认密码后，可以登陆root账户</p><p>再切换到 / 根目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /</span><br></pre></td></tr></table></figure><p>备份系统命令，此处以备份 / 分区为例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar cpzf /media/sunshine/0CFB19510CFB1951/Backup/ubuntu_backup/ubuntu_back_20200309_2031.tgz --exclude=/proc --exclude=-lost+found --exclude=/media --exclude=/mnt --exclude=/home  --exclude=/boot --exclude=run --exclude=tmp /</span><br></pre></td></tr></table></figure><p>分析一下这个命令</p><h5 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar cpz</span><br></pre></td></tr></table></figure><p><code>tar</code>命令和必要参数</p><blockquote><p>c   新建一个备份文档<br>p   保存权限，并应用到所有文件<br>z   使用gzip压缩备份文档，减少占用空间</p></blockquote><h5 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f /media/sunshine/0CFB19510CFB1951/Backup/ubuntu_backup/ubuntu_root_backup@`date +%Y-%m-%d`.tgz</span><br></pre></td></tr></table></figure><p>可选参数和指定备份文件的目的路径</p><blockquote><p>f   指定压缩包名称，只能做最后一个参数，后面接文件路径</p></blockquote><p>文件路径填你的目的路径和压缩包文件名，注意文件后缀是<code>.tgz</code></p><p>为了区分不同备份版本，在这条命令中还使用<code>date +%Y-%m-%d</code>命令，调用系统时间作为备份文件的一部分</p><p>在3月31日使用该命令时，最终的备份文件名字为<code>ubuntu_root_backup@2020-03-31.tgz</code></p><h5 id="第三部分"><a href="#第三部分" class="headerlink" title="第三部分"></a>第三部分</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--exclude=/proc --exclude=/lost+found --exclude=/media --exclude=/mnt --exclude=/tmp --exclude=/run --exclude=/home --exclude=/boot</span><br></pre></td></tr></table></figure><p>这里就是使用<code>--exclude</code>参数排除不想备份的文件夹，下面详细说明一下建议排除的文件夹以及他们的作用</p><p>/proc        虚拟文件系统，系统运行的每一个进程都会自动在这个目录下面创建一个进程目录。既然是系统自动创建，也就没必要备份的必要了<br>/lost+found   系统发生错误时（比如非法关机），可以在这里找回一些丢失文件<br>/media      多媒体挂载点，像u盘、移动硬盘、机械硬盘上的其他数据分区等都会默认挂载到这个目录下，当然了，用户也可能会自定<br>/mnt        临时挂载点，你可以自己挂载一些文件系统到这里<br>/tmp        临时文件夹，系统的一些临时文件会放在这里<br>/run        系统从启动以来产生的一些信息文件<br>/boot       和系统启动相关的文件，像grub相关文件都放在这里，这个目录很重要<br>/home      用户主目录，存放用户个人文件和应用程序</p><h5 id="第四部分"><a href="#第四部分" class="headerlink" title="第四部分"></a>第四部分</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/</span><br></pre></td></tr></table></figure><p>这是你希望备份的目录，在这个例子中是根分区</p><p>一些提示</p><p>以下是几点提示，这几点比较重要，如果忽视则可能导致一些奇怪的错误发生，或是达不到我们需要的备份效果</p><ul><li>/mmt目录需要排除在外。如果不把/mnt目录排除在外，挂载在/mnt目录上的其他分区也会被备份</li><li>/media目录需要排除在外。如果不把/media目录排除在外，挂载在/media目录上的其他分区，比如外置的存储设备也会被备份</li><li>任何挂载其他存储设备的目录都需要被排除在外。举例来说，作者的Ubuntu系统中，来自机械硬盘的<code>ntfs</code>数据分区会在开机时自动以<code>fuseblk</code>格式挂载到<code>/home/用户名/Media/</code>中，所以在备份<code>/home</code>目录时，需要排除<code>/Meia</code>目录，否则会将里面挂载的整个机械硬盘的数据备份一遍</li><li>切记要排除备份的目的文件本身所在的目录。如上面的例子中，备份文件<code>ubuntu_root_backup@2020-03-31.tgz</code>所在的目录一定要排除，否则会变成我备份我自己，可能会得到一些超出常理的备份结果，嘻嘻</li></ul><h2 id="还原系统"><a href="#还原系统" class="headerlink" title="还原系统"></a>还原系统</h2><p>备份完之后，万一有一天系统崩溃了，我们需要恢复系统，这时可以通过Ubuntu系统的安装U盘(Lived USB)进入<code>try Ubuntu</code>模式</p><p><code>tar</code>还原只能覆盖原有存在的文件，即增量还原的概念</p><p>假设备份系统时计算机中有<code>1234</code>这四个文件</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.1/200404/orgin.png" alt></p><p>需要还原系统时，计算机中的文件状态已经变成<code>1234</code>5678`，文件4由于一些原因发生了改变，新增了文件5678</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.1/200404/change.png" alt></p><p>此时若直接使用<code>tar</code>覆盖还原的方式，则计算机中的文件会变为<code>12345678</code>,文件4`被备份存档中的文件4替代，文件5678保留</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@4.0/200404/after.png" alt></p><p>当然这种情况对于日常使用的文档文件是没有问题的，如果仅对于文档备份则当然可以这么做，但对于包含程序包的备份存档，则会因为依赖变化等问题出现一些错误，所以不建议大家在系统备份中使用覆盖还原</p><p>切换到<code>root</code>用户，找到旧Ubuntu系统的根分区所在分区，一般来说，可以在Ubuntu系统的<code>/media</code>目录下面找到，使用<code>rm -rf</code>指令删除整个分区中的文件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf /media/磁盘名称/分区名称</span><br></pre></td></tr></table></figure><p>先创建一个临时目录用于挂载原系统的文件系统</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /mnt/origin/sys</span><br></pre></td></tr></table></figure><p>将原系统文件系统挂载到临时目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/分区 /mnt/origin/sys</span><br></pre></td></tr></table></figure><p>在临时目录中解压备份档案</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvpzf /media/myDisk/ubuntu_root_backup@xxxx.tar.gz -C /mnt/sys</span><br></pre></td></tr></table></figure><p>解压完成后，记得要将备份时使用<code>--exclude</code>指令排除在外的目录重新创建，否则重启系统后会遇到错误</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /mnt/sys</span><br><span class="line">mkdir proc lost+found media mnt  run tmp</span><br></pre></td></tr></table></figure><p>其中，<code>/home</code>目录和<code>/boot</code>目录在这个例子中由于是在另外的分区，删除时不会被覆盖，所以我们也不需要重新创建这两个目录</p><p>警示！！！如果在恢复系统的过程中，您修改了硬盘的分区，，各个分区的UUID发生了改变，那么重启系统前一定要根据各个分区的信息重新修改<code>/etc/fstab</code>文件，否则不能开机</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>系统的备份和还原操作对应于每个人的计算机状况不同，受限于分区情况、存储介质挂载情况、使用习惯不相同等差异，有很多种不同的方式方法和解决方案，切不可因循守旧，墨守成规，要根据自身的情况灵活判断和改变</p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> 备份 </tag>
            
            <tag> 系统维护 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu常用命令总结之二：系统信息、磁盘操作、用户权限操作、压缩操作</title>
      <link href="/archives/9ca8d389.html"/>
      <url>/archives/9ca8d389.html</url>
      
        <content type="html"><![CDATA[<p>养兵千日&nbsp;&nbsp;用兵一时</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200321/artical_200321_cover.png" alt></p><a id="more"></a><p>在使用Ubuntu系统的过程中，经常需要使用一些系统命令，Linux系发行版的最大特点也是在使用这些系统的时候，适当使用一些命令可以极大地增加使用这类系统的效率，这也是开发人员们偏爱使用这类系统的一大原因</p><p>对于Linux系发行版，理论上可以在终端使用命令，代替在图形界面中所做的一切操作，有道是，“UI能做的Terminal能做，UI不能做的Terminal一样能做”。先将日常使用中常用到的命令总结记录下来，以便日后查阅使用。第二篇中包含的大多数命令，就是用图形界面不能做到的事情了</p><h2 id="显示系统信息"><a href="#显示系统信息" class="headerlink" title="显示系统信息"></a>显示系统信息</h2><h4 id="显示处理器架构"><a href="#显示处理器架构" class="headerlink" title="显示处理器架构"></a>显示处理器架构</h4><p>使用<code>arch</code>命令显示机器的处理器架构</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch</span><br></pre></td></tr></table></figure><p>若机器为32位系统，则输出为<code>x86</code>，若为64位系统，则输出为<code>x86_64</code></p><p><code>arch</code>命令的输出是通过uname命令调取的，是ustname结构中@machine的值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">struct utsname &#123;</span><br><span class="line">  char sysname[];    // Operating system name (e.g., &quot;Linux&quot;)  内核名称 </span><br><span class="line">  char nodename[];   // Name within &quot;some implementation-defined network&quot;  网络节点上的主机名 </span><br><span class="line">  char release[];    // Operating system release (e.g., &quot;2.6.28&quot;) 内核发行号</span><br><span class="line">  char version[];    // Operating system version 内核版本</span><br><span class="line">  char machine[];    // Hardware identifier 主机的硬件架构名称 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="显示系统信息-1"><a href="#显示系统信息-1" class="headerlink" title="显示系统信息"></a>显示系统信息</h4><p>使用<code>uname</code>命令显示系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname [options] [--help] [--version]</span><br></pre></td></tr></table></figure><p>参数含义</p><p>-a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示全部的信息<br>-m&nbsp;&nbsp;&nbsp;&nbsp;显示电脑类型<br>-n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示在网络上的主机名称<br>-r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示操作系统的发行编号<br>-s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示操作系统名称<br>-v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示操作系统版本<br>--help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示帮助<br>--version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示版本信息</p><p>显示系统信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure></p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200321/uname-a.png" alt="uname -a"></p><p>显示操作系统的发行编号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200321/uname-r.png" alt="uname-r"></p><p>显示操作系统版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -v</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200321/uname-v.png" alt="uname-v"></p><p>显示uname帮助</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname --help</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200321/uname-help.png" alt="uname-help"></p><h4 id="查看所有硬件信息"><a href="#查看所有硬件信息" class="headerlink" title="查看所有硬件信息"></a>查看所有硬件信息</h4><p>使用<code>dmidecode</code>命令输出系统中所有硬件的信息，需要添加sudo前缀提供权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dmidecode</span><br></pre></td></tr></table></figure><p>使用此命令不仅可以得到当前机器上的配置，也可以得到系统支持的最大配置。这条命令参数极多，使用不同后缀可以查询不同的硬件信息，详情倾自行搜索尝试</p><h4 id="文件输出命令"><a href="#文件输出命令" class="headerlink" title="文件输出命令"></a>文件输出命令</h4><p>使用<code>cat</code>命令链接文件内容并将其输出到标准输出设备，类似于<code>type</code>命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat file</span><br></pre></td></tr></table></figure><p>可以使用<code>cat</code>命令链接系统中的所有文件并显示其内容，常用于查看一些文件信息</p><p>显示cpuinfo文件的信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo</span><br></pre></td></tr></table></figure><p>显示系统中的中断</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/interrupts</span><br></pre></td></tr></table></figure><p>显示内存使用信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/meninfo</span><br></pre></td></tr></table></figure><p>显示网络适配器及统计</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/net/dev</span><br></pre></td></tr></table></figure><p>显示已加载的文件系统</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/mounts</span><br></pre></td></tr></table></figure><h4 id="显示系统中PCI总线设备"><a href="#显示系统中PCI总线设备" class="headerlink" title="显示系统中PCI总线设备"></a>显示系统中PCI总线设备</h4><p>使用<code>lspci</code>命令列举系统中的PCI总线设备</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lspci</span><br><span class="line">lspci -tv</span><br></pre></td></tr></table></figure><p>终端会输出系统中的PCI/PCI-E总线设备</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200321/lspci.png" alt="lspci"></p><h4 id="显示系统中USB总线设备"><a href="#显示系统中USB总线设备" class="headerlink" title="显示系统中USB总线设备"></a>显示系统中USB总线设备</h4><p>使用<code>lsusb</code>命令列举系统中的USB总线设备</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsusb</span><br><span class="line">lsusb -tv</span><br></pre></td></tr></table></figure><p>终端会输出系统中的USB总线设备</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200321/lsusb.png" alt="lsusb"></p><h4 id="显示系统日期"><a href="#显示系统日期" class="headerlink" title="显示系统日期"></a>显示系统日期</h4><p>使用<code>date</code>命令显示当前系统日期时间(UTC时间)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date</span><br></pre></td></tr></table></figure><h4 id="显示日历"><a href="#显示日历" class="headerlink" title="显示日历"></a>显示日历</h4><p>使用<code>cal</code>命令显示日历，在终端中就可以显示与图形界面相仿的日历信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cal [year]</span><br></pre></td></tr></table></figure><p>显示year的日历表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cal 2020</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200321/cal.png" alt="cal 2020"></p><h4 id="设置系统时间"><a href="#设置系统时间" class="headerlink" title="设置系统时间"></a>设置系统时间</h4><p>使用<code>date</code>命令设置系统日期和时间</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date [month][date][hour][minute][year].[second]</span><br></pre></td></tr></table></figure><p>设置系统时间为2020年3月21日17:00:00</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date 032117002020.00</span><br></pre></td></tr></table></figure><h4 id="保存系统时间"><a href="#保存系统时间" class="headerlink" title="保存系统时间"></a>保存系统时间</h4><p>使用<code>clock</code>命令保存系统时间修改到BIOS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clock -w</span><br></pre></td></tr></table></figure><h2 id="系统关机、重启、运行等级"><a href="#系统关机、重启、运行等级" class="headerlink" title="系统关机、重启、运行等级"></a>系统关机、重启、运行等级</h2><h4 id="关闭系统命令"><a href="#关闭系统命令" class="headerlink" title="关闭系统命令"></a>关闭系统命令</h4><p>使用<code>shutdown</code>命令关闭系统</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown [-t seconds] [-rkhncfF] time [message]</span><br></pre></td></tr></table></figure><p>参数含义</p><p>-t seconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设定在t秒后关闭系统<br>-r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关机后重新开机<br>-k&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;并不会真的关机，只是将警告讯息传送给所有使用者<br>-h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关机后停机<br>-n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不采用正常程序来关机，用强迫的方式杀掉所有执行中的程序后自行关机<br>-c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取消目前已经进行中的关机动作。<br>-f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关机时，不做 fsck 动作(检查 Linux 文件系统)<br>-F&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关机时，强迫进行 fsck 动作<br>time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设定关机的时间，单位为分钟<br>message&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;传送给所有使用者的警告讯息</p><p>示例</p><p>立即关闭系统</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -h now</span><br></pre></td></tr></table></figure><p>10分钟后关机，并向使用者发出提醒</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -h +5 “The System will shutdown after 5 minutes”</span><br></pre></td></tr></table></figure><p>在20:35重启计算机</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -r 20:35</span><br></pre></td></tr></table></figure><p>取消当前正在计时的关机任务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -c</span><br></pre></td></tr></table></figure><h4 id="退出当前账号"><a href="#退出当前账号" class="headerlink" title="退出当前账号"></a>退出当前账号</h4><p>使用<code>logout</code>命令退出当前账号，需要在root账户下操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logout</span><br></pre></td></tr></table></figure><h4 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h4><p>使用<code>reboot</code>命令重启系统</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot [-n] [-w] [-d] [-f] [-i]</span><br></pre></td></tr></table></figure><p>参数含义<br>-n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在重开机前不做将记忆体资料写回硬盘的动作<br>-w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;并不会真的重开机，只是把记录写到/var/log/wtmp档案里<br>-d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不把记录写到 /var/log/wtmp 档案里（-n这个参数包含了-d）<br>-f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;强迫重开机，不呼叫 shutdown 这个指令<br>-i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在重开机之前先把所有网络相关的装置先停止</p><h4 id="系统运行等级"><a href="#系统运行等级" class="headerlink" title="系统运行等级"></a>系统运行等级</h4><p>使用<code>init</code>命令调整系统运行等级(run level)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init [mode]</span><br></pre></td></tr></table></figure><p>参数含义<br>0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;停机<br>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;单用户模式<br>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;多用户模式，没有NFS且无网络连接<br>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;完全多用户模式，命令行模式(标准系统运行等级)<br>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不可用<br>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;图形化界面模式<br>6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;重新启动<br>s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;单用户模式，不配置网络和后台进程</p><p>关闭系统，shutdown命令就是运用了这个机制</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init 0</span><br></pre></td></tr></table></figure><p>重启系统，reboot命令就是运用了这个机制</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init 6</span><br></pre></td></tr></table></figure><p>通过修改系统的initdefault属性(对应于不同的发行版这个属性有不同的名字，Ubuntu18中已经这个名称已经修改)，可以修改系统的默认启动属性。</p><p>警示！无论何时都不能将initdefault设置为1或者6，这会将系统启动时的默认run level改变，导致系统不停关机或重启</p><h4 id="系统运行等级之二"><a href="#系统运行等级之二" class="headerlink" title="系统运行等级之二"></a>系统运行等级之二</h4><p>使用<code>telinit</code>命令调整系统运行等级(run level)，命令格式和<code>init</code>相同</p><p><code>telinit</code>命令是<code>init</code>命令的软连接，用户程序通过<code>telinit</code>修改run level</p><p>(作者这么写的目的就是为了让用户多写3个字符吗)</p><p>由于<code>init</code>进程是PID=1的进程，是所有进程的老祖宗，推测是为了系统安全和稳定性</p><h2 id="文件挂载卸载"><a href="#文件挂载卸载" class="headerlink" title="文件挂载卸载"></a>文件挂载卸载</h2><h4 id="文件或驱动器挂载"><a href="#文件或驱动器挂载" class="headerlink" title="文件或驱动器挂载"></a>文件或驱动器挂载</h4><p>使用<code>mount</code>命令挂载Linux系统外的文件，在系统目录下操作可能需要添加sudo前缀提供权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mount [-hV]</span><br><span class="line">mount -a [-fFnrsvw] [-t vfstype]</span><br><span class="line">mount [-fnrsvw] [-o options [,...]] device | dir</span><br><span class="line">mount [-fnrsvw] [-t vfstype] [-o options] device dir</span><br></pre></td></tr></table></figure><p>参数含义</p><p>-V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示程序版本<br>-h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示辅助讯息</p><p>-v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示较讯息，通常和 -f 用来除错<br>-a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将 /etc/fstab 中定义的所有档案系统挂上<br>-F&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个命令通常和 -a 一起使用，它会为每一个 mount 的动作产生一个行程负责执行。在系统需要挂上大量 NFS 档案系统时可以加快挂上的动作<br>-f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通常用在除错的用途。它会使 mount 并不执行实际挂上的动作，而是模拟整个挂上的过程。通常会和 -v 一起使用<br>-n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;一般而言，mount 在挂上后会在 /etc/mtab 中写入一笔资料。但在系统中没有可写入档案系统存在的情况下可以用这个选项取消这个动作<br>-s-r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;等于 -o ro<br>-w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;等于 -o rw<br>-L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将含有特定标签的硬盘分割挂上<br>-U&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将档案分割序号为 的档案系统挂下。-L 和 -U 必须在/proc/partition 这种档案存在时才有意义<br>-t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指定档案系统的型态，通常不必指定。mount 会自动选择正确的型态</p><p>-o async&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;打开非同步模式，所有的档案读写动作都会用非同步模式执行<br>-o sync&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在同步模式下执行<br>-o atime、-o noatime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当 atime 打开时，系统会在每次读取档案时更新档案的『上一次调用时间』。当我们使用 flash 档案系统时可能会选项把这个选项关闭以减少写入的次数<br>-o auto、-o noauto&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;打开/关闭自动挂上模式<br>-o defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用预设的选项 rw, suid, dev, exec, auto, nouser, and async<br>-o dev、-o nodev、-o exec、-o noexec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;允许执行档被执行<br>-o suid、-o nosuid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;允许执行档在 root 权限下执行<br>-o user、-o nouser&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用者可以执行 mount/umount 的动作<br>-o remount&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将一个已经挂下的档案系统重新用不同的方式挂上。例如原先是唯读的系统，现在用可读写的模式重新挂上<br>-o ro&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;用唯读模式挂上<br>-o rw&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;用可读写模式挂上<br>-o loop=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用 loop 模式用来将一个档案当成硬盘分割挂上系统</p><p>示例</p><p>将/dev/hda1挂载/mnt目录下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/hda1 /mnt</span><br></pre></td></tr></table></figure><p>将/dev/hda1用只读模式挂载在/mut目录下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o ro /dev/hda1 /mnt</span><br></pre></td></tr></table></figure><p>将AAA.iso的image文档使用loop模式挂载在/mmt/AAA文件夹下，这条命令在使用软件ISO安装包时非常好用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o loop AAA.iso /mnt/AAA</span><br></pre></td></tr></table></figure><h4 id="驱动器卸载"><a href="#驱动器卸载" class="headerlink" title="驱动器卸载"></a>驱动器卸载</h4><p>使用<code>umount</code>命令卸载目前挂载在系统中的文件系统</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount [-ahnrvV][-t &lt;文件系统类型&gt;][文件系统]</span><br></pre></td></tr></table></figure><p>参数含义<br>-a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;卸除/etc/mtab中记录的所有文件系统<br>-h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示帮助<br>-n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;卸除时不要将信息存入/etc/mtab文件中<br>-r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;若无法成功卸除，则尝试以只读的方式重新挂入文件系统<br>-v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;执行时显示详细的信息<br>-V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示版本信息<br>-t&lt;文件系统类型&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;仅卸除选项中所指定的文件系统<br>[文件系统]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;除了直接指定文件系统外，也可以用设备名称或挂入点来表示文件系统</p><p>示例</p><p>通过设备名和挂载点卸载文件系统，同时输出详细信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umount -v /dev/sda1   //通过设备名卸载</span><br><span class="line">umount -v /mnt/AAA    //通过挂载点卸载</span><br></pre></td></tr></table></figure><p>如果设备正忙，卸载则会失败，这个问题的常见原因是，某个打开的shell当前目录为挂载点中的某个目录</p><p>运行卸载操作而不写入<code>/etc/mtab</code>文件- 当文件为只读或当磁盘写满时非常有用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount -n /mnt/sda1</span><br></pre></td></tr></table></figure><h4 id="强制驱动器卸载-解除占用"><a href="#强制驱动器卸载-解除占用" class="headerlink" title="强制驱动器卸载(解除占用)"></a>强制驱动器卸载(解除占用)</h4><p>使用<code>fuser</code>命令找出占用某个文件、驱动器、TCP、UDP、端口号的进程，并可以结束进程，借出对象的占用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fuser [options] [paras]</span><br></pre></td></tr></table></figure><p>参数含义<br>-a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示命令行中指定的所有文件<br>-k&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;杀死访问指定文件的所有进程<br>-i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;杀死进程前需要用户进行确认<br>-l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;列出所有已知信号名<br>-m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指定一个被加载的文件系统或一个被加载的块设备<br>-n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;选择不同的名称空间<br>-u&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在每个进程后显示所属的用户名</p><p>paras&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;被占用的对象，可以是文件、驱动器、TCP、UDP、端口号等</p><p>列出使用<code>/etc/passwd</code>文件的本地进程的进程号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fuser /etc/passwd</span><br></pre></td></tr></table></figure></p><p>列出使用<code>/etc/filesystems</code>文件的进程的进程号和用户登录名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fuser -u /etc/filesystems</span><br></pre></td></tr></table></figure><p>终止使用给定文件系统的所有进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fuser -k -x -u -c /dev/hd1  or  fuser -kxuc /home</span><br></pre></td></tr></table></figure><p>在驱动器繁忙时强制卸载驱动器，并清除所有占用此驱动器的进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fuser -km /mnt/sda1</span><br></pre></td></tr></table></figure><h2 id="分区错误检查"><a href="#分区错误检查" class="headerlink" title="分区错误检查"></a>分区错误检查</h2><h4 id="检查修复文件系统错误"><a href="#检查修复文件系统错误" class="headerlink" title="检查修复文件系统错误"></a>检查修复文件系统错误</h4><p>在Linux系统关机过程中，系统会对文件系统进行检查，若出现问题则系统不能正常关闭。使用<code>fsck</code>命令检查并尝试修复文件系统中的错误，此外，不应该使用<code>fsck</code>命令检查已挂载的磁盘，可能对磁盘造成永久的伤害，在检查之前建议卸载磁盘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsck [options] [para]</span><br></pre></td></tr></table></figure><p>参数含义</p><p>-a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;自动修复文件系统，不询问任何问题<br>-A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;依照/etc/fstab配置文件的内容，检查文件内所列的全部文件系统<br>-N&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不执行指令，仅列出实际执行会进行的动作<br>-P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当搭配”-A”参数使用时，则会同时检查所有的文件系统<br>-r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;采用互动模式，在执行修复时询问问题，让用户得以确认并决定处理方式<br>-R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当搭配”-A”参数使用时，则会略过/目录的文件系统不予检查<br>-s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;依序执行检查作业，而非同时执行<br>-T&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;执行fsck指令时，不显示标题信息<br>-V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示指令执行过程<br>-t [文件系统类型]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指定要检查的文件系统类型，若在 /etc/fstab 中已有定义或 kernel 本身已支援的则不需加上此参数</p><p>另外，在运行 fsck 时，可能出错并返回一些错误码。下面是一些常见的错误及其意义</p><p>0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;没有错误<br>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修复了一些文件系统错误<br>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;系统需要被重启<br>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;文件系统错误未被修复<br>8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;操作错<br>16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用或语法错<br>32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fsck 被用户取消<br>128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;共享库出错</p><p>对单个目录进行错误检查并进行自动修复，-a也可用-y代替</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsck -a /dev/sda1</span><br></pre></td></tr></table></figure><p>仅检查文件系统错误，不进行修复</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsck -n /dev/sda1</span><br></pre></td></tr></table></figure><p>检查所有分区上的所有文件错误</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fsck -A</span><br><span class="line">fsck -AR  //禁止对根文件目录进行检查</span><br></pre></td></tr></table></figure><p>只检查指定文件系统类型分区</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fsck -t ext4 /dev/sda1  //检查ext4类型的sda1分区</span><br><span class="line">fsck -t -A ext4         //检查所有ext4类型的所有分区</span><br></pre></td></tr></table></figure><p>只在卸载的磁盘上进行磁盘错误检查</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsck -AM</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> 学习 </tag>
            
            <tag> 备份 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu常用命令总结之一：终端设置、部分系统命令、文件操作、目录操作</title>
      <link href="/archives/c77b8e4a.html"/>
      <url>/archives/c77b8e4a.html</url>
      
        <content type="html"><![CDATA[<p>会者不难&nbsp;&nbsp;难者不会&nbsp;&nbsp;常用则熟&nbsp;&nbsp;少用则疏</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200307/articai_200307_cover.png" alt></p><a id="more"></a><p>在使用Ubuntu系统的过程中，经常需要使用一些系统命令，Linux系发行版的最大特点也是在使用这些系统的时候，适当使用一些命令可以极大地增加使用这类系统的效率，这也是开发人员们偏爱使用这类系统的一大原因</p><p>对于Linux系发行版，理论上可以在终端使用命令，代替在图形界面中所做的一切操作，有道是，“UI能做的Terminal能做，UI不能做的Terminal一样能做”。先将日常使用中常用到的命令总结记录下来，以便日后查阅使用</p><h2 id="终端设置"><a href="#终端设置" class="headerlink" title="终端设置"></a>终端设置</h2><h4 id="默认打开的终端"><a href="#默认打开的终端" class="headerlink" title="默认打开的终端"></a>默认打开的终端</h4><p>对大部分的发行版来说，例如Ubuntu、Manjaro、Linux Mint等，进入终端的快捷键都是Ctrl+Shift+T，此时打开的终端的默认操作目录是/home/用户名目录。从下图可以看到，在直接打开的命令行下，默认操作目录是/home/sunshine</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200307/terminal_base.png" alt="base"></p><h4 id="在特定位置打开的终端"><a href="#在特定位置打开的终端" class="headerlink" title="在特定位置打开的终端"></a>在特定位置打开的终端</h4><p>有时候，我们需要快速打开一个在当前操作目录的终端，此时可以在系统自带的文件管理器中打开该文件夹，右键列表中会有“在命令行中打开”选项，通过这个选项打开的命令行的默认操作目录则会在当前目录下。</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200307/terminal_special.png" alt="specials"></p><h4 id="终端设置-1"><a href="#终端设置-1" class="headerlink" title="终端设置"></a>终端设置</h4><p>选择“Edit”-“Preferences”可打开终端设置界面，在此处可以设置终端主题，颜色背景、所使用的字体、终端大小，终端的缓冲区大小等设置，自行探索即可</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200307/terminal-setting.png" alt="setting"></p><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="系统命令"><a href="#系统命令" class="headerlink" title="系统命令"></a>系统命令</h3><h4 id="软件包更新"><a href="#软件包更新" class="headerlink" title="软件包更新"></a>软件包更新</h4><p>更新软件列表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></p><p>根据软件列表下载并安装软件包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure></p><p>这两条命令往往一起使用，作为Ubuntu更新的命令，第一条命令的作用是与Ubuntu的软件列表镜像服务器同步，根据当前系统安装的软件列表检查是否有版本更新以及依赖变化，将变化的软件列表同步到本地；第二条命令根据第一条命令的软件列表，从服务器上拉取安装包并自动安装</p><p>在软件依赖发生变化时，有时会出现依赖错误的问题，或是由于网络通信问题，缺少一些安装包，此时需要输入命令补全，一般需要输入这条命令时，命令行的输出都会给出提示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get upgrade fix-missing</span><br></pre></td></tr></table></figure></p><h4 id="补全"><a href="#补全" class="headerlink" title="补全"></a>补全</h4><p>当我们在输入一些长文件名或命令时，手动输入比较麻烦而且可能出错，此时可以输入一部分，按TAB键进行补全，命令行会自动补全到没有重复的最后部分，若有多个项目的前面部分相同，按多次TAB可显示出全部的候选项可供选择</p><h4 id="显示文件目录高级属性"><a href="#显示文件目录高级属性" class="headerlink" title="显示文件目录高级属性"></a>显示文件目录高级属性</h4><p>使用<code>lsattr</code>命令显示文件属性，在系统目录下操作可能需要添加sudo前缀提供权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsattr [options] files or directory</span><br></pre></td></tr></table></figure><p>参数属性</p><p>-a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示所有文件和目录，包括以”.”为名称开头字符的额外内建，现行目录”.”与上层目录”..”<br>-d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示，目录名称，而非其内容<br>-l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此参数目前没有任何作用<br>-R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;递归处理，将指定目录下的所有文件及子目录一并处理<br>-v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示文件或目录版本<br>-V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示版本信息</p><h4 id="改变文件目录高级属性"><a href="#改变文件目录高级属性" class="headerlink" title="改变文件目录高级属性"></a>改变文件目录高级属性</h4><p>查看文件高级属性后，可以使用<code>chattr</code>命令改变文件属性，在系统目录下操作可能需要添加sudo前缀提供权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr [-RV][-v&lt;版本编号&gt;][+/-/=&lt;属性&gt;][文件或目录...]</span><br></pre></td></tr></table></figure><p>参数含义<br>-R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;递归处理，将指定目录下的所有文件及子目录一并处理<br>-v&lt;版本编号&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设置文件或目录版本<br>-V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示指令执行过程<br>+&lt;属性&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开启文件或目录的该项属性<br>-&lt;属性&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关闭文件或目录的该项属性<br>=&lt;属性&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指定文件或目录的该项属性</p><p>属性含义</p><p>a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;让文件或目录仅供附加用途<br>b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不更新文件或目录的最后存取时间<br>c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将文件或目录压缩后存放<br>d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将文件或目录排除在倾倒操作之外<br>i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不得任意更动文件或目录<br>s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;保密性删除文件或目录<br>S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;即时更新文件或目录<br>u&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;预防意外删除</p><p>示例</p><p>使用<code>chattr</code>命令防止系统关键文件AAA被修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr +i AAA</span><br></pre></td></tr></table></figure><p>使用<code>chattr</code>命令使系统关键文件AAA只能添加不能减少，使用于日记文件一类的关键文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr +a AAA</span><br></pre></td></tr></table></figure><p>使用<code>chattr</code>命令使系统关键文件AAA被意外删除</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr +u AAA</span><br></pre></td></tr></table></figure><p>添加u属性后，即使使用<code>sudo rm</code>指令也无法删除，要删除需要先去除u属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr -u AAA</span><br></pre></td></tr></table></figure><h4 id="权限更改操作"><a href="#权限更改操作" class="headerlink" title="权限更改操作"></a>权限更改操作</h4><p>使用<code>chmod</code>指令更改文件权限，是十分常用好用的命令，在系统目录下操作可能需要添加sudo前缀提供权限</p><p>Linux发行版的文件调用权限分为三级：文件拥有者、群组、其他，可借用chmod控制文件如何被他人调用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod [-cfvR] [--help] [--version] mode file</span><br></pre></td></tr></table></figure><p>mode：权限设定字符串，参数设定如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ugoa][[+-=][rwxX]</span><br></pre></td></tr></table></figure><p>参数含义</p><p>u&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示该文件的拥有者<br>g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示与该文件的拥有者属于同一个群体(group)者<br>o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示其他以外的人<br>a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示这三者皆是</p><p>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示增加权限<br>-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示取消权限<br>=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示唯一设定权限</p><p>r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示可读取<br>w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示可写入<br>x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示可执行<br>X&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示只有当该文件是个子目录或者该文件已经被设定过为可执行</p><p>-c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;若该文件权限确实已经更改，才显示其更改动作<br>-f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;若该文件权限无法被更改也不要显示错误讯息<br>-v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示权限变更的详细资料<br>-R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当前目录下的所有文件与子目录进行相同的权限变更(即以递回的方式逐个变更)</p><p>help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示辅助说明<br>version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示版本</p><h4 id="权限更改操作的简单版本"><a href="#权限更改操作的简单版本" class="headerlink" title="权限更改操作的简单版本"></a>权限更改操作的简单版本</h4><p>在日常使用中，还有一种更简便的方法，在系统目录下操作可能需要添加sudo前缀提供权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod abc file</span><br></pre></td></tr></table></figure><p>其中，a、b、c分别是一个数字，代表User、Group、Others的权限</p><p>r(read) = 4，w(write) = 2，x(可执行权限) = 1</p><p>若要rwx属性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;则4+2+1=7<br>若要rw-属性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;则4+2=6<br>若要r-x属性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;则4+1=5</p><p>以下两条命令效果等价(读+写+可执行)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a=rwx file</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 file</span><br></pre></td></tr></table></figure><p>另外，执行以下命令可使此程序具有root的权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 4755 filename</span><br></pre></td></tr></table></figure><p>显示其他系统信息的命令</p><h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><h4 id="列出文件"><a href="#列出文件" class="headerlink" title="列出文件"></a>列出文件</h4><p>使用<code>ls</code>命令列出当前文件夹下的可视文件与文件夹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls [option]</span><br></pre></td></tr></table></figure></p><p>参数含义<br>留空&nbsp;&nbsp;仅列出当前文件夹下的可视文件于文件夹<br>-a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示当前文件夹下所有文件与文件夹，包括隐藏的项目<br>-l &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示当前文件夹下所有文件的权限、所有人、修改日期、文件名等信息</p><p><code>ls -l</code>示例：</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200307/ls-l.png" alt="ls -l示例"></p><h4 id="文件比较"><a href="#文件比较" class="headerlink" title="文件比较"></a>文件比较</h4><p>使用<code>CMP</code>命令比较两个文件是否完全相同<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmp [-clsv][-i &lt;字符数目&gt;][--help][First][First]</span><br></pre></td></tr></table></figure></p><p>当两个文件完全一样时，终端不会输出信息；当两个文件不相同，则会输出第一个不相同的字符和列数编号</p><p>若终端输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmp:EOF on First</span><br></pre></td></tr></table></figure></p><p>则说明First与Second前面的部分相同，但Second还含有后面的部分</p><p>参数含义</p><p>-c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;除了标明差异处的十进制字码之外，一并显示该字符所对应字符<br>-i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指定一个数目<br>-l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;标示出所有不一样的地方<br>-s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不显示错误信息<br>-v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示版本信息</p><h4 id="文件复制"><a href="#文件复制" class="headerlink" title="文件复制"></a>文件复制</h4><p>使用<code>mv</code>命令进行文件复制，在系统目录下操作可能需要添加sudo前缀提供权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp [options] source dest</span><br></pre></td></tr></table></figure></p><p>参数含义</p><p>-d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;复制时保留链接。这里所说的链接相当于Windows系统中的快捷方式<br>-f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;覆盖已经存在的目标文件而不给出提示<br>-i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;与-f选项相反，在覆盖目标文件之前给出提示，要求用户确认是否覆盖，回答”y”时目标文件将被覆盖<br>-p&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;除复制文件的内容外，还把修改时间和访问权限也复制到新文件中<br>-r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;若给出的源文件是一个目录文件，此时将复制该目录下所有的子目录和文件<br>-l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不复制文件，只是生成链接文件<br>-a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此选项通常在复制目录时使用，它保留链接、文件属性，并复制目录下的所有内容。其作用等于dpR参数组合</p><h4 id="文件移动"><a href="#文件移动" class="headerlink" title="文件移动"></a>文件移动</h4><p>使用<code>mv</code>命令进行文件移动，还可进行文件重命名操作，在系统目录下操作可能需要添加sudo前缀提供权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv [options] source dest</span><br></pre></td></tr></table></figure></p><p>参数含义</p><p>-i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;若指定目录已有同名文件，则先询问是否覆盖旧文件<br>-f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在 mv 操作要覆盖某已有的目标文件时不给任何指示</p><p>示例：</p><p>将文件123重命名为456<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv 123 456</span><br></pre></td></tr></table></figure></p><p>将aaa文件放入bbb目录中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv aaa bbb</span><br></pre></td></tr></table></figure></p><p>将aaa目录放入bbb目录中，若bbb目录不存在，则该命令将aaa目录重命名为bbb目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv aaa/ bbb</span><br></pre></td></tr></table></figure></p><h4 id="文件删除"><a href="#文件删除" class="headerlink" title="文件删除"></a>文件删除</h4><p>使用<code>rm</code>命令删除文件，在系统目录下操作可能需要添加sudo前缀提供权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm [options] name...</span><br></pre></td></tr></table></figure><p>参数含义</p><p>-i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;删除前逐一询问确认<br>-f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;即使原档案属性设为唯读，亦直接删除，无需逐一确认<br>-r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将目录及以下之档案亦逐一删除</p><p>警示：使用rm命令删除的文件除了进行数据恢复以外无法恢复，使用这条命令必须格外小心</p><h4 id="文件寻找"><a href="#文件寻找" class="headerlink" title="文件寻找"></a>文件寻找</h4><p>使用<code>find</code>命令用来在指定目录下查找文件。任何位于参数之前的字符串都将被视为欲查找的目录名。如果使用该命令时，不设置任何参数，则find命令将在当前目录下查找子目录与文件。并且将查找到的子目录和文件全部进行显示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find path [options] [-print] [-exec -ok]</span><br></pre></td></tr></table></figure><p>参数含义<br><code>find</code>命令根据下列规则判断 path 和 expression，在命令列上第一个[-options]之前的部份为 path，之后的是 expression。如果 path 是空字串则使用目前路径，如果 expression 是空字串则使用 -print 为预设 expression</p><p>expression 中可使用的选项有二三十个之多，在此只介绍最常用的部份</p><p>-mount, -xdev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;只检查和指定目录在同一个文件系统下的文件，避免列出其它文件系统中的文件<br>-amin n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在过去 n 分钟内被读取过<br>-anewer file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;比文件 file 更晚被读取过的文件<br>-atime [n]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在过去n天内被读取过的文件<br>-cmin [n]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在过去 n 分钟内被修改过<br>-cnewer [file]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;比文件 file 更新的文件<br>-ctime [n]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在过去n天内被修改过的文件<br>-empty&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;空的文件<br>-group [name]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group ID,名称是 name<br>-ipath [p], -path [p]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;路径名称符合 p 的文件，ipath 会忽略大小写<br>-name [name], -iname [name]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;文件名称符合 name 的文件。iname 会忽略大小写<br>-size [n]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;文件大小 是 n 单位，b 代表 512 位元组的区块，c 表示字元数，k 表示 kilo bytes，w 是二个位元组<br>-type b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;区块装置文件<br>-type c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;字符设备文件<br>-type d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目录<br>-type f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;一般文件<br>-type l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;符号链接文件<br>-type p&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;管道文件<br>-pid [n]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process id 是 n 的文件</p><h3 id="目录操作"><a href="#目录操作" class="headerlink" title="目录操作"></a>目录操作</h3><h4 id="新建文件夹操作"><a href="#新建文件夹操作" class="headerlink" title="新建文件夹操作"></a>新建文件夹操作</h4><p>使用<code>mkdir</code>命令新建文件夹，在系统目录下操作可能需要添加sudo前缀提供权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir [-p] dirName</span><br></pre></td></tr></table></figure><p>参数含义</p><p>-p&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;确保目录名称存在，不存在的路径会自动新建</p><p>若要创建的目录中包含子目录，则建议使用<code>-p</code>参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p AAA/BBB/CCC</span><br></pre></td></tr></table></figure><h4 id="删除目录"><a href="#删除目录" class="headerlink" title="删除目录"></a>删除目录</h4><p>同删除文件的命令一样，使用<code>rm</code>命令删除文件夹，在系统目录下操作可能需要添加sudo前缀提供权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -r AAA/BBB</span><br></pre></td></tr></table></figure><h4 id="当前工作目录"><a href="#当前工作目录" class="headerlink" title="当前工作目录"></a>当前工作目录</h4><p>在终端中，使用<code>pwd</code>命令显示当前工作目录，pwd是print working directory的缩写</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br></pre></td></tr></table></figure><p>（效果图片）</p><h4 id="改变当前目录"><a href="#改变当前目录" class="headerlink" title="改变当前目录"></a>改变当前目录</h4><p>使用<code>cd</code>命令改变当前工作目录</p><p>前进到当前路径下的AAA文件夹中的BBB文件夹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd AAA/BBB</span><br></pre></td></tr></table></figure><p>返回到当前路径的父目录，..两个点表示父目录，….四个点表示父目录的父目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br></pre></td></tr></table></figure><p>返回到上一次所使用的目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd -</span><br></pre></td></tr></table></figure><h4 id="复制当前目录"><a href="#复制当前目录" class="headerlink" title="复制当前目录"></a>复制当前目录</h4><p>使用<code>cp</code>命令复制文件夹，在系统目录下操作可能需要添加sudo前缀提供权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp [options] source dest</span><br></pre></td></tr></table></figure><p>参数含义</p><p>-r 复制文件夹以及该文件夹下所有子文件夹，也可以直接使用-a参数</p><h4 id="移动当前目录"><a href="#移动当前目录" class="headerlink" title="移动当前目录"></a>移动当前目录</h4><p>使用<code>mv</code>命令移动文件夹，在系统目录下操作可能需要添加sudo前缀提供权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv [options] sourceLocation destLocation</span><br></pre></td></tr></table></figure><p>-r 复制文件夹以及该文件夹下所有子文件夹，如果源目录和目标目录位置相同，则是文件夹重命名操作</p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> command </tag>
            
            <tag> 学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu下使用deepin-wine安装QQ、TIM、微信步骤与注意事项 (2020最全总结)</title>
      <link href="/archives/e0be4fc3.html"/>
      <url>/archives/e0be4fc3.html</url>
      
        <content type="html"><![CDATA[<p>步骤有点复杂，但一定好用</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@3.0/200222/artical_200222_cover.png" alt></p><a id="more"></a><p>在很久很久很久之前，linux还是个小宝宝的时候，为了与当时的竞争对手（当然了现在也是）Windows竞争市场份额，双方展开了激烈的竞争，linux为了使得自己的系统也能够兼容一部分之前只能运行在Windows上的程序，建立了一个名为Wine的兼容层。</p><p>现在的Wine已经能在众多linux发行版上运行大量Windows程序</p><p>在Wine的发展过程中，为了兼容众多复杂的Windows特性，不得已加入了大量特性，众所周知，“有代码就有bug”，因此容器化的Wine或多或少存在一些问题。在此处感谢深度团队的付出，他们改进了Wine中的诸多缺陷，发展出了deepin-wine，感谢wszqkzqk同学将这份成果适配到Ubuntu/Debian平台。现在将在Ubuntu平台下使用deepin-wine配置TIM、WeChat以及QQ的过程以及遇到的问题记录为笔记</p><p>笔者配置的平台为Ubuntu18.04LTS，使用的Gnome-shell版本为3.28，记录一下供大家参考</p><h2 id="安装deepin-wine"><a href="#安装deepin-wine" class="headerlink" title="安装deepin-wine"></a>安装deepin-wine</h2><p>deepin-wine的安装可以通过源码进行，<a href="https://github.com/wszqkzqk/deepin-wine-ubuntu" target="_blank" rel="noopener">Github项目地址</a></p><p>将项目Clone到本地或直接下载后再解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/wszqkzqk/deepin-wine-ubuntu.git</span><br></pre></td></tr></table></figure></p><p>国内的网络环境如果没有梯子的话，访问github的速度可能比较慢，可以使用gitee的镜像地址，速度更快<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu.git</span><br></pre></td></tr></table></figure></p><p>或者直接下载作者打包好的Releases：视网络环境选择<a href="https://github.com/wszqkzqk/deepin-wine-ubuntu/releases" target="_blank" rel="noopener">Github</a>和<a href="https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu/releases" target="_blank" rel="noopener">Gitee</a></p><p>切换到项目文件目录，对install.sh赋予可执行权限，下面命令中的777是指对User、Group、Other的权限分别为7,代表Read(4)+Write(2)+执行权限(1)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 777 ./install.sh</span><br></pre></td></tr></table></figure></p><p>执行install.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./install.sh</span><br></pre></td></tr></table></figure></p><p>执行此步骤后TIM已经能正常安装，Wechat还需进一步设置</p><h2 id="安装对应容器"><a href="#安装对应容器" class="headerlink" title="安装对应容器"></a>安装对应容器</h2><p>安装完deepin-wine后，只是完成了wine环境的搭建，使用应用程序还需要安装对应的容器</p><p>对应应用的容器（.deb文件）可以在此处下载：</p><p><a href="https://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/deepin.com.qq.im_9.1.8deepin0_i386.deb" target="_blank" rel="noopener">QQ</a>(deepin.com.qq.im_9.1.8deepin0_i386.deb)<br><a href="https://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/deepin.com.qq.office_2.0.0deepin4_i386.deb" target="_blank" rel="noopener">TIM</a>(deepin.com.qq.office_2.0.0deepin4_i386.deb)<br><a href="https://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/deepin.com.wechat_2.6.8.65deepin0_i386.deb" target="_blank" rel="noopener">微信</a>(deepin.com.wechat_2.6.8.65deepin0_i386.deb)</p><p>下载完后切换到下载的文件目录，使用Terminal安装</p><p>QQ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i deepin.com.qq.im_9.1.8deepin0_i386.deb</span><br></pre></td></tr></table></figure></p><p>TIM<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i deepin.com.qq.office_2.0.0deepin4_i386.deb</span><br></pre></td></tr></table></figure></p><p>微信<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i deepin.com.wechat_2.6.8.65deepin0_i386.deb</span><br></pre></td></tr></table></figure></p><h2 id="更新deepin-wine到新版本"><a href="#更新deepin-wine到新版本" class="headerlink" title="更新deepin-wine到新版本"></a>更新deepin-wine到新版本</h2><p>经过上一个步骤后，deepin-wine的版本为2.18-12，此时安装微信会遇到依赖问题</p><p>阅读系统给出的提示我们可以得知最新的微信容器需要deepin-wine版本在2.18-19以上，但当前安装的版本为2.18-12，故需要更新版本</p><p>deepin-wine目前在阿里云的<a href="https://developer.aliyun.com/mirror/" target="_blank" rel="noopener">镜像服务器</a>上能够下载到，不过缺点是阿里云上的分支不会收录旧版本文件，需要根据当时服务器上的文件版本修改命令</p><p>原命令在此<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">mkdir /tmp/deepintemp</span><br><span class="line">cd /tmp/deepintemp</span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine/deepin-wine_2.18-22~rc0_all.deb</span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine/deepin-wine32_2.18-22~rc0_i386.deb</span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine/deepin-wine32-preloader_2.18-22~rc0_i386.deb</span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine/deepin-fonts-wine_2.18-22~rc0_all.deb</span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine/deepin-libwine_2.18-22~rc0_i386.deb</span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine-helper/deepin-wine-helper_1.2deepin8_i386.deb</span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine-plugin/deepin-wine-plugin_1.0deepin2_amd64.deb</span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine-plugin-virtual/deepin-wine-plugin-virtual_1.0deepin3_all.deb</span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine-uninstaller/deepin-wine-uninstaller_0.1deepin2_i386.deb</span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/u/udis86/udis86_1.72-2_i386.deb</span><br><span class="line">wget https://mirrors.aliyun.com/deepin/pool/main/libj/libjpeg-turbo/libjpeg62-turbo_1.5.1-2_amd64.deb</span><br><span class="line">wget https://mirrors.aliyun.com/deepin/pool/main/libj/libjpeg-turbo/libjpeg62-turbo_1.5.1-2_i386.deb</span><br><span class="line"></span><br><span class="line">echo &apos;准备添加32位支持&apos;</span><br><span class="line">sudo dpkg --add-architecture i386</span><br><span class="line">echo &apos;添加成功，准备刷新apt缓存信息...&apos;</span><br><span class="line">sudo apt update</span><br><span class="line">echo &apos;即将开始安装...&apos;</span><br><span class="line">sudo dpkg -i *.deb</span><br><span class="line">echo &apos;安装完成，正在自动安装依赖...&apos;</span><br><span class="line">sudo apt install -fy</span><br><span class="line"></span><br><span class="line">rm -vfr /tmp/deepintemp</span><br></pre></td></tr></table></figure></p><p>阿里云经常会更新deepin-wine的版本，若使用上述代码更新时系统返回HTTP 404错误（获取不到对应的程序包），除了检查网络问题以外，还有较大的可能是命令中的程序包版本跟阿里云服务器上的新版本不对应，这时可以自行到阿里云镜像查看当前能用的版本</p><p>举个栗子，对于下面的链接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine/deepin-wine_2.18-22~rc0_all.deb</span><br></pre></td></tr></table></figure></p><p>如果程序包版本不对，返回以下信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP request sent, awaiting response... 404 Not Found</span><br></pre></td></tr></table></figure></p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@2.1/200222/terminal.png" alt="Terminal报错"></p><p>这时我们需要访问</p><p><a href="https://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine/" target="_blank" rel="noopener">https://mirrors.aliyun.com/deepin/pool/non-free/d/deepin-wine/</a></p><p>没错，就是上面我们wget请求过的链接的一部分，浏览器会自动跳转到阿里云镜像服务器的文件列表</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@2.1/200222/Index-of-deepin-pool-non-free-d-deepin-wine.png" alt="aliyun"></p><p>我们可以看到我们想要请求的程序包名称</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deepin-wine_2.18-22~rc0_all.deb</span><br></pre></td></tr></table></figure><p>当前服务器上的最新程序包版本为2.18-22~rc0_all.deb,此时我们需要将所有HTTP 404错误的程序包更换为统一的新版本，更换之后即可正常更新，更新后微信也可以正常安装了</p><h2 id="非中文系统的中文方框问题-amp-中文系统的换字体问题"><a href="#非中文系统的中文方框问题-amp-中文系统的换字体问题" class="headerlink" title="非中文系统的中文方框问题&amp;中文系统的换字体问题"></a>非中文系统的中文方框问题&amp;中文系统的换字体问题</h2><p>在Ubuntu系统语言不是中文的情况下，deepin-wine的默认语言跟随系统语言设置，导致所有deepin-wine容器的默认字体不支持所有的中文字体，导致部分中文字体出现乱码和方框，我们解决这个问题的思路是通过更换对中文支持好的字体，作者自己是使用微软雅黑替换deepin-wine的默认显示字体</p><p>修改deepin-wine的两个文件（作者使用的编辑器是gedit）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /opt/deepinwine/tools/run.sh</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /opt/deepinwine/tools/run_v2.sh</span><br></pre></td></tr></table></figure><p>在文件中找到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WINE_CMD=&quot;deepin-wine&quot;</span><br></pre></td></tr></table></figure></p><p>修改成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WINE_CMD=&quot;LC_ALL=zh_CN.UTF-8 deepin-wine&quot;</span><br></pre></td></tr></table></figure></p><p>如果只修改<code>run.sh</code>一个文件，微信有可能还是显示中文方框</p><p>（作者就是在这里卡了好久，ひどい！）</p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@2.1/200222/run_v2-sh-gedit.png" alt="run.sh"></p><p><a href="https://pan.baidu.com/s/12aj25hOPAf6NzV3Hdyl9Mw" target="_blank" rel="noopener">百度云</a>下载通用字体（此处使用的是微软雅黑）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">链接: https://pan.baidu.com/s/12aj25hOPAf6NzV3Hdyl9Mw 提取码: dikf</span><br></pre></td></tr></table></figure></p><p>切换到存放字体的文件夹，将下载的字体复制到deepin-wechat容器里（TIM和QQ只需将Deepin-Wechat替换为Deepin-TIM和Deepin-QQ即可）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp msyh.ttc ~/.deepinwine/Deepin-WeChat/drive_c/windows/Fonts</span><br></pre></td></tr></table></figure></p><p>更改该容器的注册表（TIM和QQ只需将Deepin-Wechat替换为Deepin-TIM和Deepin-QQ即可）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gedit ~/.deepinwine/Deepin-WeChat/system.reg</span><br></pre></td></tr></table></figure></p><p>找到以下两行内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;MS Shell Dlg&quot;=xxx</span><br><span class="line">&quot;MS Shell Dlg 2&quot;=xxx</span><br></pre></td></tr></table></figure></p><p>修改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;MS Shell Dlg&quot;=“msyh”</span><br><span class="line">&quot;MS Shell Dlg 2&quot;=“msyh”</span><br></pre></td></tr></table></figure></p><p>在某个位置新建<code>msyh_config.reg</code>注册字体<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gedit msyh_config.reg</span><br></pre></td></tr></table></figure></p><p>在文件<code>msyh_config.reg</code>中添加如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">REGEDIT4</span><br><span class="line">[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\FontLink\SystemLink]</span><br><span class="line">&quot;Lucida Sans Unicode&quot;=&quot;msyh.ttc&quot;</span><br><span class="line">&quot;Microsoft Sans Serif&quot;=&quot;msyh.ttc&quot;</span><br><span class="line">&quot;MS Sans Serif&quot;=&quot;msyh.ttc&quot;</span><br><span class="line">&quot;Tahoma&quot;=&quot;msyh.ttc&quot;</span><br><span class="line">&quot;Tahoma Bold&quot;=&quot;msyhbd.ttc&quot;</span><br><span class="line">&quot;msyh&quot;=&quot;msyh.ttc&quot;</span><br><span class="line">&quot;Arial&quot;=&quot;msyh.ttc&quot;</span><br><span class="line">&quot;Arial Black&quot;=&quot;msyh.ttc&quot;</span><br></pre></td></tr></table></figure></p><p>最后一步，注册该字体（注册字体只需执行一次）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deepin-wine regedit msyh_config.reg</span><br></pre></td></tr></table></figure></p><p><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@2.1/200222/deepin-wine_QQ.png" alt="deepin-wine-QQ"><br><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@2.1/200222/deepin-wine_TIM_004.png" alt="deepin-wine-TIM"><br><img src="https://cdn.jsdelivr.net/gh/Sunshine-0215/CDN_Personalblog_202001@2.1/200222/deepin-wine_WeChat.png" alt="deepin-wine-Wechat"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> deepin-wine </tag>
            
            <tag> TIM </tag>
            
            <tag> Wehcat </tag>
            
            <tag> QQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>更新计划</title>
      <link href="/archives/9284d20.html"/>
      <url>/archives/9284d20.html</url>
      
        <content type="html"><![CDATA[<p>按目前的节奏，更新暂定是每两周咕咕一篇，周六推送到服务器上，也许可能咕咕咕咕咕(?)</p><p>不过我会尽力补上的</p><p>2020-05-02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;游戏推荐：AER Memories of Old</p><p>2020-04-18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;游戏推荐：Ori and the Blind Forest</p><p>2020-04-04&nbsp;&nbsp;<a href="d58ae5e.html">(传送门)</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ubuntu系统备份方式记录</p><p>2020-03-21&nbsp;&nbsp;<a href="9ca8d389.html">(传送门)</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ubuntu系统常用命令总结(二)</p><p>2020-03-07&nbsp;&nbsp;<a href="c77b8e4a.html">(传送门)</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ubuntu系统常用命令总结(一)</p><p>2020-02-22&nbsp;&nbsp;<a href="e0be4fc3.html">(传送门)</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ubuntu下使用deepin-wine安装QQ、TIM、微信步骤与注意事项</p>]]></content>
      
      
      
        <tags>
            
            <tag> 更新 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
